<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inline Query æµ‹è¯•</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #0088cc;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #006699;
        }
        .log {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Inline Query æµ‹è¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h3>ğŸ“± Telegram WebApp çŠ¶æ€</h3>
        <div id="webapp-status">æ£€æŸ¥ä¸­...</div>
        <button onclick="checkWebAppStatus()">é‡æ–°æ£€æŸ¥</button>
    </div>
    
    <div class="test-section">
        <h3>ğŸš€ æµ‹è¯• Inline Query</h3>
        <button onclick="testBasicInlineQuery()">åŸºç¡€ Inline Query</button>
        <button onclick="testRichMediaQuery()">å¯Œåª’ä½“ Inline Query</button>
        <button onclick="testCustomQuery()">è‡ªå®šä¹‰æŸ¥è¯¢</button>
    </div>
    
    <div class="test-section">
        <h3>ğŸ“‹ è°ƒè¯•æ—¥å¿—</h3>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="log" class="log"></div>
    </div>

    <script>
        let tg = null;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }
        
        function checkWebAppStatus() {
            log('ğŸ” æ£€æŸ¥ Telegram WebApp çŠ¶æ€...');
            
            if (window.Telegram?.WebApp) {
                tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                const status = `
                    âœ… WebApp SDK å·²åŠ è½½
                    ğŸ“± ç‰ˆæœ¬: ${tg.version}
                    ğŸ–¥ï¸ å¹³å°: ${tg.platform}
                    ğŸ‘¤ ç”¨æˆ·: ${tg.initDataUnsafe?.user?.first_name || 'æœªçŸ¥'}
                    ğŸ”§ switchInlineQuery: ${typeof tg.switchInlineQuery === 'function' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}
                    ğŸ”§ shareToStory: ${typeof tg.shareToStory === 'function' ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}
                `;
                
                document.getElementById('webapp-status').innerHTML = status.replace(/\n/g, '<br>');
                log('âœ… WebApp çŠ¶æ€æ£€æŸ¥å®Œæˆ');
                
                // æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ–¹æ³•
                log('ğŸ”§ å¯ç”¨æ–¹æ³•: ' + Object.keys(tg).join(', '));
                
            } else {
                const status = 'âŒ Telegram WebApp SDK æœªåŠ è½½';
                document.getElementById('webapp-status').innerHTML = status;
                log('âŒ WebApp SDK æœªåŠ è½½');
            }
        }
        
        function testBasicInlineQuery() {
            log('ğŸ§ª æµ‹è¯•åŸºç¡€ Inline Query...');
            
            if (!tg) {
                log('âŒ WebApp æœªåˆå§‹åŒ–');
                return;
            }
            
            if (typeof tg.switchInlineQuery !== 'function') {
                log('âŒ switchInlineQuery æ–¹æ³•ä¸å¯ç”¨');
                return;
            }
            
            try {
                tg.switchInlineQuery('test_basic', ['users', 'groups']);
                log('âœ… åŸºç¡€ inline query è°ƒç”¨æˆåŠŸ');
            } catch (error) {
                log('âŒ åŸºç¡€ inline query è°ƒç”¨å¤±è´¥: ' + error.message);
            }
        }
        
        function testRichMediaQuery() {
            log('ğŸ¨ æµ‹è¯•å¯Œåª’ä½“ Inline Query...');
            
            if (!tg) {
                log('âŒ WebApp æœªåˆå§‹åŒ–');
                return;
            }
            
            if (typeof tg.switchInlineQuery !== 'function') {
                log('âŒ switchInlineQuery æ–¹æ³•ä¸å¯ç”¨');
                return;
            }
            
            try {
                const queryData = {
                    type: 'rich_media',
                    image: 'https://via.placeholder.com/800x400/667eea/ffffff?text=Test+Image',
                    title: 'ğŸ§ª æµ‹è¯•å¯Œåª’ä½“åˆ†äº«',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å¯Œåª’ä½“æ¶ˆæ¯ï¼ŒåŒ…å«å›¾ç‰‡å’ŒæŒ‰é’®',
                    buttonText: 'æ‰“å¼€æµ‹è¯•åº”ç”¨',
                    miniAppUrl: window.location.href
                };
                
                const query = `rich_media:${JSON.stringify(queryData)}`;
                log('ğŸ“¤ å‘é€æŸ¥è¯¢: ' + query);
                
                tg.switchInlineQuery(query, ['users', 'groups']);
                log('âœ… å¯Œåª’ä½“ inline query è°ƒç”¨æˆåŠŸ');
            } catch (error) {
                log('âŒ å¯Œåª’ä½“ inline query è°ƒç”¨å¤±è´¥: ' + error.message);
            }
        }
        
        function testCustomQuery() {
            const customQuery = prompt('è¾“å…¥è‡ªå®šä¹‰æŸ¥è¯¢å†…å®¹:', 'custom_test');
            if (customQuery) {
                log('ğŸ”§ æµ‹è¯•è‡ªå®šä¹‰æŸ¥è¯¢: ' + customQuery);
                
                try {
                    tg.switchInlineQuery(customQuery, ['users', 'groups']);
                    log('âœ… è‡ªå®šä¹‰æŸ¥è¯¢è°ƒç”¨æˆåŠŸ');
                } catch (error) {
                    log('âŒ è‡ªå®šä¹‰æŸ¥è¯¢è°ƒç”¨å¤±è´¥: ' + error.message);
                }
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.addEventListener('load', () => {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(checkWebAppStatus, 500);
        });
        
        // ç›‘å¬ Telegram äº‹ä»¶
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.onEvent('themeChanged', () => {
                log('ğŸ¨ ä¸»é¢˜å·²æ›´æ”¹');
            });
        }
    </script>
</body>
</html>