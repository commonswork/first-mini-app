# 调试指南

## 新增的调试工具

现在有 **3 个强大的调试工具** 帮助你在 Mini App 中调试：

### 1. 🔍 实时状态面板（VisualDebug）

位置：页面顶部

**功能：**
- 实时显示 Telegram SDK 状态
- 显示版本信息
- 显示支持的方法
- 操作日志记录
- 内置测试按钮

**使用方法：**
1. 打开 Mini App
2. 查看顶部的"实时状态"卡片
3. 点击"测试基础功能"按钮
4. 点击"测试分享"按钮
5. 查看操作日志

### 2. 📋 调试日志（ConsoleLogger）

位置：页面底部（黑色面板）

**功能：**
- 拦截所有 console.log 输出
- 在页面上显示日志
- 支持不同日志级别（LOG/INFO/WARN/ERROR）
- 可以展开/收起/清空

**使用方法：**
- 日志会自动显示在底部
- 点击"展开/收起"控制显示
- 点击"清空"清除日志
- 点击"×"隐藏面板
- 隐藏后点击左下角的📋按钮重新显示

### 3. 🔧 调试信息（DebugInfo）

位置：右下角橙色按钮

**功能：**
- 显示详细的 Telegram WebApp 信息
- 测试各种方法
- 查看完整的 WebApp 对象

**使用方法：**
1. 点击右下角的橙色按钮
2. 查看详细信息
3. 点击测试按钮

## 调试步骤

### 步骤 1：检查基础状态

打开 Mini App 后，查看顶部的"实时状态"面板：

```
✅ Telegram SDK: 已加载
✅ 版本: 6.0
❌ switchInlineQuery: 不支持
✅ openLink: 支持
✅ 用户 ID: 123456789
```

### 步骤 2：测试基础功能

点击"测试基础功能"按钮，会：
1. 检查 SDK 是否初始化
2. 显示版本和平台信息
3. 显示用户信息
4. 弹出测试提示

**查看操作日志：**
```
12:34:56 开始测试基础功能
12:34:56 ✅ SDK 版本: 6.0
12:34:56 ✅ 平台: ios
12:34:56 ✅ 用户: 张三 (123456789)
12:34:56 ✅ showAlert 测试成功
```

### 步骤 3：测试分享功能

点击"测试分享"按钮，会：
1. 检查版本支持
2. 尝试调用相应的分享方法
3. 记录详细的调用过程

**查看操作日志：**
```
12:35:10 开始测试分享功能
12:35:10 当前版本: 6.0
12:35:10 ⚠️ 版本过低，使用备用方案
12:35:10 ✅ openLink 可用
12:35:10 尝试调用 shareFallback...
12:35:11 shareFallback 调用结果: true
```

### 步骤 4：查看底部日志

滚动到页面底部，查看黑色的调试日志面板：

```
12:35:11 LOG >>> 使用备用分享方案
12:35:11 LOG 使用备用分享方案, message: 测试分享
12:35:11 LOG 分享 URL: https://t.me/share/url?url=...
12:35:11 LOG 尝试使用 openLink...
12:35:11 LOG ✅ openLink 调用成功
```

### 步骤 5：实际测试分享

点击"📤 分享到群组"按钮，然后：

1. 查看"实时状态"面板的"最后操作"
2. 查看"操作日志"中的新记录
3. 查看底部日志面板的详细输出

## 常见问题诊断

### 问题 1：点击按钮没反应

**检查：**
1. 实时状态面板显示什么？
2. 操作日志有新记录吗？
3. 底部日志有输出吗？

**可能原因：**
- SDK 未加载：实时状态显示"❌ 未加载"
- 方法不支持：openLink 显示"❌ 不支持"
- JavaScript 错误：查看底部日志的 ERROR

### 问题 2：分享功能不可用

**检查实时状态：**
```
版本: 6.0
switchInlineQuery: ❌ 不支持  ← 正常，版本太低
openLink: ❌ 不支持  ← 问题！应该支持
```

**解决方法：**
- 如果 openLink 不支持，说明 Telegram 版本有问题
- 尝试更新 Telegram
- 或者使用其他设备测试

### 问题 3：看不到日志

**检查：**
1. 底部日志面板是否被隐藏？
   - 点击左下角的📋按钮显示
2. 日志面板是否被收起？
   - 点击"展开"按钮
3. 日志是否被清空？
   - 重新操作生成新日志

## 调试技巧

### 技巧 1：使用操作日志追踪

每次点击按钮后，立即查看"操作日志"：
- 绿色：成功
- 红色：错误
- 橙色：警告
- 蓝色：信息

### 技巧 2：对比测试

1. 先点击"测试分享"
2. 查看日志输出
3. 再点击"分享到群组"
4. 对比两次的日志

### 技巧 3：截图分享

如果需要帮助，截图以下内容：
1. 实时状态面板（显示版本和支持情况）
2. 操作日志（显示具体错误）
3. 底部日志面板（显示详细调用过程）

## 示例：完整的调试流程

```
1. 打开 Mini App
   → 查看实时状态：SDK 已加载，版本 6.0

2. 点击"测试基础功能"
   → 弹出提示：✅ 基础功能测试成功
   → 操作日志：显示 SDK 版本和用户信息

3. 点击"测试分享"
   → 操作日志：显示"使用备用方案"
   → 底部日志：显示详细的调用过程
   → 结果：shareFallback 调用结果: true

4. 点击"分享到群组"
   → 操作日志：记录分享操作
   → 底部日志：显示 openLink 调用
   → 预期：打开分享界面或显示错误

5. 如果失败
   → 查看操作日志中的错误信息
   → 查看底部日志的 ERROR 记录
   → 根据错误信息采取行动
```

## 导出日志

如果需要保存日志：

1. 展开底部日志面板
2. 长按日志内容
3. 选择"复制"
4. 粘贴到记事本保存

或者：

1. 在实时状态面板截图
2. 在底部日志面板截图
3. 发送给开发者

## 性能提示

调试工具会占用一些资源，如果不需要调试：

1. 点击底部日志面板的"×"关闭
2. 点击右下角调试按钮的"隐藏"
3. 只保留实时状态面板用于监控

## 总结

现在你有 3 个强大的工具：

1. **实时状态面板** - 快速查看状态和测试
2. **调试日志面板** - 查看详细的 console 输出
3. **调试信息按钮** - 查看完整的技术信息

使用这些工具，你可以：
- ✅ 实时查看 SDK 状态
- ✅ 测试各种功能
- ✅ 追踪操作日志
- ✅ 诊断问题原因
- ✅ 无需打开浏览器控制台

祝调试顺利！🎉
